<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>India States Map - Leaflet</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> Â 
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <style>
        body {
            overflow: hidden;
            /* Hide scrollbars */
            background-color: black;

        }

        #map {
            height: 100vh;
            width: 100%;
        }

        .leaflet-container {
            background: transparent !important;

        }

        .state-label {
            color: black;
            font-size: 10px;
            background-color: white;
            font-weight: bold;
            border-radius: 15px;
            text-align: center;
            padding: 5px;
            line-height: 1;
            /* text-shadow: 1px 1px gray; */
            /* box-shadow: 5px 5px #888888; */
            box-shadow: 0 0 0 3px #888888;

        }
    </style>
</head>

<body>

    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        $(document).ready(
            // $("body").css({ "transform": "scale(0.9)", "-moz-transform": "scale(0.9)" })

        )

        // RTO code data
        const statesRto = {
            "states": [
                { "name": "Andhra Pradesh", "rtoCode": "AP" },
                { "name": "Arunachal Pradesh", "rtoCode": "AR" },
                { "name": "Assam", "rtoCode": "AS" },
                { "name": "Bihar", "rtoCode": "BR" },
                { "name": "Chhattisgarh", "rtoCode": "CG" },
                { "name": "Goa", "rtoCode": "GA" },
                { "name": "Gujarat", "rtoCode": "GJ" },
                { "name": "Haryana", "rtoCode": "HR" },
                { "name": "Himachal Pradesh", "rtoCode": "HP" },
                { "name": "Jharkhand", "rtoCode": "JH" },
                { "name": "Karnataka", "rtoCode": "KA" },
                { "name": "Kerala", "rtoCode": "KL" },
                { "name": "Madhya Pradesh", "rtoCode": "MP" },
                { "name": "Maharashtra", "rtoCode": "MH" },
                { "name": "Manipur", "rtoCode": "MN" },
                { "name": "Meghalaya", "rtoCode": "ML" },
                { "name": "Mizoram", "rtoCode": "MZ" },
                { "name": "Nagaland", "rtoCode": "NL" },
                { "name": "Odisha", "rtoCode": "OD" },
                { "name": "Punjab", "rtoCode": "PB" },
                { "name": "Rajasthan", "rtoCode": "RJ" },
                { "name": "Sikkim", "rtoCode": "SK" },
                { "name": "Tamil Nadu", "rtoCode": "TN" },
                { "name": "Telangana", "rtoCode": "TG" },
                { "name": "Tripura", "rtoCode": "TR" },
                { "name": "Uttar Pradesh", "rtoCode": "UP" },
                { "name": "Uttarakhand", "rtoCode": "UK" },
                { "name": "West Bengal", "rtoCode": "WB" },
                { "name": "Andaman and Nicobar Islands", "rtoCode": "AN" },
                { "name": "Chandigarh", "rtoCode": "CH" },
                { "name": "Dadra and Nagar Haveli and Daman and Diu", "rtoCode": "DD" },
                { "name": "Delhi", "rtoCode": "DL" },
                { "name": "Jammu and Kashmir", "rtoCode": "JK" },
                { "name": "Ladakh", "rtoCode": "LA" },
                { "name": "Lakshadweep", "rtoCode": "LD" },
                { "name": "Puducherry", "rtoCode": "PY" }
            ]
        }



        function getStateCode(stateName) {
            if (!stateName) return '';  // Return an empty string if the state name is undefined or null
            const state = statesRto.states.find(s => s.name.toLowerCase() === stateName.toLowerCase());
            // console.log(`${stateName} - ${state.name} ${stateName === state.name}`)
            return state ? state.rtoCode : '';
        }

        // Initialize the map without zoom and pan features
        var map = L.map('map', {
            zoomControl: false,
            dragging: false,
            doubleClickZoom: false,
            scrollWheelZoom: false,
            touchZoom: false,
            zoomSnap: 0.1
        }).setView([20.5937, 78.9629], 5);  // Center on India

        // Fetch GeoJSON data
        fetch('/map/export.geojson')
            .then(response => response.json())
            .then(data => {
                // Add GeoJSON layer to the map
                L.geoJSON(data, {
                    filter: function (feature) {
                        return feature.geometry.type === 'Polygon' || feature.geometry.type === 'MultiPolygon';
                    },
                    style: function (feature) {
                        return {
                            color: getRandomColor(),
                            weight: 1,
                            fillOpacity: 1
                        };
                    },
                    onEachFeature: function (feature, layer) {
                        if (feature.geometry.type === 'Polygon' || feature.geometry.type === 'MultiPolygon') {
                            const popupContent = '<b>' + feature.properties.name + '</b>';

                            // Bind popup with state name on click
                            layer.bindPopup(popupContent);

                            // Trigger popup on hover (mouseover)
                            layer.on('mouseover', function (e) {
                                layer.bindPopup(popupContent).openPopup(e.latlng);
                            });

                            // Add RTO code as a label on the map
                            var center = layer.getBounds().getCenter();  // Get center of the polygon
                            var stateCode = getStateCode(feature.properties.name);
                            if (stateCode) {
                                L.marker(center, {
                                    icon: L.divIcon({
                                        className: 'state-label',
                                        html: '<b>' + stateCode + '<br>14</b>',
                                        iconSize: [30, 30]
                                    })
                                }).addTo(map);
                            }
                        }
                    }
                }).addTo(map);
            });

        // Function to generate random colors
        const usedColors = [];

        function getRandomColor() {
            let color;
            do {
                // Generate random color
                color = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
            } while (usedColors.includes(color) || color === '#000000' || color === '#FFFFFF');

            usedColors.push(color);
            return color;
        }

    </script>

</body>

</html>